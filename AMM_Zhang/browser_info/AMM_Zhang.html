<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory AMM_Zhang</title>
</head>


<body>
<div class="head">
<h1>Theory AMM_Zhang</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="AMM_Zhang.html"><span>AMM_Zhang</span></a><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Real.html"><span>HOL.Real</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This is an attempt at translating the AMM formalization of Zhang et al. 
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>url</span></span><span> </span><a href="https://github.com/runtimeverification/verified-smart-contracts/blob/uniswap/uniswap/x-y-k.pdf"><span>"https://github.com/runtimeverification/verified-smart-contracts/blob/uniswap/uniswap/x-y-k.pdf"</span></a><span class="antiquote"><span>}</span></span></span><span> in Isabelle/HOL›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We formalize a basic constant-product liquidity pool.
We define an add-liquidity and a remove-liquidity operation on a pool whose token amounts are reals.
We also define the code versions of those operations, where amounts are rounded to obtain integers.
Rounding the wrong way can allow an attacker to drain the pool.
We would like to prove that this cannot happen.›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Pool state"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.pool_state.arity_full_exhaustive_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_inst.full_exhaustive_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_random_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_inst.random_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_equal_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_inst.equal_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_partial_term_of_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_triv|fact"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_inst.partial_term_of_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_term_of_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_triv|fact"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_inst.term_of_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.iffs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.simps|fact"><span class="entity_def" id="AMM_Zhang.pool_state.cases|fact"><span class="entity_def" id="AMM_Zhang.pool_state.cases_scheme|fact"><span class="entity_def" id="AMM_Zhang.pool_state.induct|fact"><span class="entity_def" id="AMM_Zhang.pool_state.induct_scheme|fact"><span class="entity_def" id="AMM_Zhang.pool_state.equality|fact"><span class="entity_def" id="AMM_Zhang.pool_state.surjective|fact"><span class="entity_def" id="AMM_Zhang.pool_state.defs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.splits|fact"><span class="entity_def" id="AMM_Zhang.pool_state.unfold_congs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.fold_congs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.update_defs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.select_defs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.update_convs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.select_convs|fact"><span class="entity_def" id="AMM_Zhang.pool_state.truncate_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.extend_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.fields_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.make_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.more_update_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.l_update_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.y_update_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.x_update_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.more_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.l_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.y_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.x_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.ext_split|fact"><span class="entity_def" id="AMM_Zhang.pool_state.ext_surjective|fact"><span class="entity_def" id="AMM_Zhang.pool_state.ext_inject|fact"><span class="entity_def" id="AMM_Zhang.pool_state.ext_induct|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.pool_state_ext_Tuple_Iso_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_typerep_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_def|fact"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_inst.typerep_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_induct|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_induct|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_cases|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_cases|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_inject|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_inject|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_inverse|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_inverse|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.type_definition_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_type_pool_state_ext|fact"><span class="entity_def" id="AMM_Zhang.pool_state.arity_full_exhaustive_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_inst.full_exhaustive_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_random_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_inst.random_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_equal_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_inst.equal_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_partial_term_of_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_triv|thm"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_inst.partial_term_of_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_term_of_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_triv|thm"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_inst.term_of_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.iffs|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(8)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(7)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(6)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(5)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.simps(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.cases|thm"><span class="entity_def" id="AMM_Zhang.pool_state.cases_scheme|thm"><span class="entity_def" id="AMM_Zhang.pool_state.induct|thm"><span class="entity_def" id="AMM_Zhang.pool_state.induct_scheme|thm"><span class="entity_def" id="AMM_Zhang.pool_state.equality|thm"><span class="entity_def" id="AMM_Zhang.pool_state.surjective|thm"><span class="entity_def" id="AMM_Zhang.pool_state.defs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.defs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.defs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.defs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.splits(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.splits(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.splits(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.unfold_congs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.unfold_congs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.unfold_congs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.unfold_congs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.fold_congs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.fold_congs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.fold_congs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.fold_congs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_defs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_defs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_defs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_defs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_defs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_defs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_defs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_defs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_convs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_convs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_convs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.update_convs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_convs(4)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_convs(3)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_convs(2)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.select_convs(1)|thm"><span class="entity_def" id="AMM_Zhang.pool_state.truncate_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.extend_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.fields_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.make_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.more_update_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.l_update_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.y_update_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.x_update_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.more_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.l_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.y_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.x_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.ext_split|thm"><span class="entity_def" id="AMM_Zhang.pool_state.ext_surjective|thm"><span class="entity_def" id="AMM_Zhang.pool_state.ext_inject|thm"><span class="entity_def" id="AMM_Zhang.pool_state.ext_induct|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.pool_state_ext_Tuple_Iso_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_typerep_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_def|thm"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_inst.typerep_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_induct|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_induct|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_cases|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_cases|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_inject|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_inject|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext_inverse|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext_inverse|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.type_definition_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.arity_type_pool_state_ext|thm"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_def_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_inst.full_exhaustive_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_def_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_inst.random_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_def_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_inst.equal_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_triv_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_inst.partial_term_of_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_triv_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_inst.term_of_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.truncate_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.extend_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.fields_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.make_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.more_update_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.l_update_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.y_update_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.x_update_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.more_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.l_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.y_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.x_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.pool_state_ext_Tuple_Iso_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_def_raw|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_inst.typerep_pool_state_ext_def|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.type_definition_pool_state_ext|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.arity_type_pool_state_ext|axiom"><span class="entity_def" id="AMM_Zhang.pool_state.full_exhaustive_pool_state_ext_inst.full_exhaustive_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.random_pool_state_ext_inst.random_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.equal_pool_state_ext_inst.equal_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.partial_term_of_pool_state_ext_inst.partial_term_of_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.term_of_pool_state_ext_inst.term_of_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.truncate|const"><span class="entity_def" id="AMM_Zhang.pool_state.extend|const"><span class="entity_def" id="AMM_Zhang.pool_state.fields|const"><span class="entity_def" id="AMM_Zhang.pool_state.make|const"><span class="entity_def" id="AMM_Zhang.pool_state.more_update|const"><span class="entity_def" id="AMM_Zhang.pool_state.l_update|const"><span class="entity_def" id="AMM_Zhang.pool_state.y_update|const"><span class="entity_def" id="AMM_Zhang.pool_state.x_update|const"><span class="entity_def" id="AMM_Zhang.pool_state.more|const"><span class="entity_def" id="AMM_Zhang.pool_state.l|const"><span class="entity_def" id="AMM_Zhang.pool_state.y|const"><span class="entity_def" id="AMM_Zhang.pool_state.x|const"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.pool_state_ext_Tuple_Iso|const"><span class="entity_def" id="AMM_Zhang.pool_state.typerep_pool_state_ext_inst.typerep_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Abs_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext.Rep_pool_state_ext|const"><span class="entity_def" id="AMM_Zhang.pool_state.pool_state_ext|type"><span>record</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.pool_state_scheme|type"><span class="entity_def" id="AMM_Zhang.pool_state|type"><span>pool_state</span></span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="comment1"><span>― ‹A liquidity pool between tokens x and y; l is the token representing pool shares›</span></span><span>
  x </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  y </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  l </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.k_def|fact"><span class="entity_def" id="AMM_Zhang.k_def|thm"><span class="entity_def" id="AMM_Zhang.k_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.k|const"><span>k</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>k</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Adding liquidity"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.add_liquidity_spec_def|fact"><span class="entity_def" id="AMM_Zhang.add_liquidity_spec_def|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_spec_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.add_liquidity_spec|const"><span>add_liquidity_spec</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>add_liquidity_spec</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>α</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>⦇</span></span><span>x </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> y </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> l </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>⦈</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.add_liquidity_code_spec_def|fact"><span class="entity_def" id="AMM_Zhang.add_liquidity_code_spec_def|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_code_spec_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.add_liquidity_code_spec|const"><span>add_liquidity_code_spec</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>add_liquidity_code_spec</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
    </span><span class="main"><span>⦇</span></span><span>x </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span class="main"><span>,</span></span><span>
     y </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>― ‹note we need to round in favor of the pool or the pool can be drained›</span></span><span>
     l </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span class="bound"><span class="entity"><span>Δx</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span class="main"><span>⦈</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.l1|fact"><span class="entity_def" id="AMM_Zhang.l1|thm"><span>l1</span></span></span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>a</span></span><span>
  </span><span class="comment1"><span>― ‹this simple lemma helps automated provers a lot›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groebner_Basis.html#Groebner_Basis.algebra|method"><span class="operator"><span>algebra</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_1360..1365">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.add_liquidity_properties|fact"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(15)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(14)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(13)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(12)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(11)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(10)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(9)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(8)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(7)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(6)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(5)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(4)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(3)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(2)|thm"><span class="entity_def" id="AMM_Zhang.add_liquidity_properties(1)|thm"><span>add_liquidity_properties</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>:</span></span><span>  
  </span><span class="comment1"><span>― ‹properties of add-liquidity›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δx</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p'</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec|const"><span>add_liquidity_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δx</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p''</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec|const"><span>add_liquidity_code_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δx</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.eq_divide_imp|fact"><span>eq_divide_imp</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.ext_inject|fact"><span>ext_inject</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.le_divide_eq_1|fact"><span>le_divide_eq_1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.surjective|fact"><span>surjective</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span>(</span></span><span>1-4</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.add_divide_distrib|fact"><span>add_divide_distrib</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.eq_divide_eq_1|fact"><span>eq_divide_eq_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.nonzero_eq_divide_eq|fact"><span>nonzero_eq_divide_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_irrefl|fact"><span>order_less_irrefl</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.linordered_idom_class.of_int_0_le_iff|fact"><span>of_int_0_le_iff</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.zero_le_floor|fact"><span>zero_le_floor</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.left_commute|fact"><span>mult.left_commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_le_less_imp_less|fact"><span>mult_le_less_imp_less</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_right|fact"><span>nonzero_mult_div_cancel_right</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.times_divide_eq_right|fact"><span>times_divide_eq_right</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_cancel_left_pos|fact"><span>mult_less_cancel_left_pos</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span>(</span></span><span>1-4</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groebner_Basis.html#Groebner_Basis.algebra|method"><span class="operator"><span>algebra</span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_le_divide_eq|fact"><span>pos_le_divide_eq</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>,</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>Δx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_strict_right_mono|fact"><span>divide_strict_right_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.less_floor_iff|fact"><span>less_floor_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_strict_left_mono|fact"><span>mult_strict_left_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_code_spec_def|fact"><span>add_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>,</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_le_cancel|fact"><span>divide_le_cancel</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l1|fact"><span>l1</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.nonzero_eq_divide_eq|fact"><span>nonzero_eq_divide_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_left|fact"><span>nonzero_mult_divide_mult_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec_def|fact"><span>add_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.nonzero_eq_divide_eq|fact"><span>nonzero_eq_divide_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_left|fact"><span>nonzero_mult_divide_mult_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_1360..1365"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Removing liquidity"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.remove_liquidity_spec_def|fact"><span class="entity_def" id="AMM_Zhang.remove_liquidity_spec_def|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_spec_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>remove_liquidity_spec</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>α</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>⦇</span></span><span>x </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> y </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> l </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>α</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>⦈</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.remove_liquidity_code_spec_def|fact"><span class="entity_def" id="AMM_Zhang.remove_liquidity_code_spec_def|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_code_spec_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.remove_liquidity_code_spec|const"><span>remove_liquidity_code_spec</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>remove_liquidity_code_spec</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
    </span><span class="main"><span>⦇</span></span><span>x </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span class="main"><span>,</span></span><span>
     y </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌊</span></a></span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Archimedean_Field.html#Archimedean_Field.floor_ceiling_class.floor|const"><span>⌋</span></a></span><span class="main"><span>,</span></span><span>
     l </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Δl</span></span></span></span><span class="main"><span>⦈</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.l2|fact"><span class="entity_def" id="AMM_Zhang.l2|thm"><span>l2</span></span></span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>Δl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>Δl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>a</span></span><span>
    </span><span class="comment1"><span>― ‹this simple lemma helps automated provers a lot›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groebner_Basis.html#Groebner_Basis.algebra|method"><span class="operator"><span>algebra</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_5518..5523">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties|fact"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(12)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(11)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(10)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(9)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(8)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(7)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(6)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(5)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(4)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(3)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(2)|thm"><span class="entity_def" id="AMM_Zhang.remove_liquidity_properties(1)|thm"><span>remove_liquidity_properties</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="comment1"><span>― ‹properties of remove-liquidity›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δl</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Δl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>Δl</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p'</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δl</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p''</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_code_spec|const"><span>remove_liquidity_code_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δl</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l2|fact"><span>l2</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>7</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l2|fact"><span>l2</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_code_spec_def|fact"><span>remove_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l2|fact"><span>l2</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l2|fact"><span>l2</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_code_spec_def|fact"><span>remove_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l2|fact"><span>l2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_right|fact"><span>nonzero_mult_div_cancel_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_less_iff_gr_or_eq|fact"><span>not_less_iff_gr_or_eq</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>pool_state.select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_code_spec_def|fact"><span>remove_liquidity_code_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_code_spec_def|fact"><span>remove_liquidity_code_spec_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_less_eq_1_pos|fact"><span>divide_less_eq_1_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_cancel_left_pos|fact"><span>mult_less_cancel_left_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Factorial.html#Factorial.mult_less_iff1|fact"><span>mult_less_iff1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_less_eq_1_pos|fact"><span>divide_less_eq_1_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_cancel_left_pos|fact"><span>mult_less_cancel_left_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>pool_state.select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>pool_state.select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult_ac|fact"><span>ab_semigroup_mult_class.mult_ac</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.left_commute|fact"><span>mult.left_commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.nonzero_eq_divide_eq|fact"><span>nonzero_eq_divide_eq</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power2|const"><span><span class="hidden">⇧</span><sup>2</sup></span></a></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k|const"><span>k</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_right_mono|fact"><span>divide_right_mono</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.k_def|fact"><span>k_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.less_le_not_le|fact"><span>less_le_not_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.eq_divide_eq_1|fact"><span>eq_divide_eq_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_left|fact"><span>divide_divide_eq_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_5518..5523"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"No free money"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Here we want to prove that, no matter what sequence of operations one applies,
withdrawing all the liquidity obtained leaves the pool with at least the same amount of tokens it started from.
We could formalize executions as lists, inductive invariants, etc.›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.inv_def|fact"><span class="entity_def" id="AMM_Zhang.inv_def|thm"><span class="entity_def" id="AMM_Zhang.inv_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.inv|const"><span>inv</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span>in</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="AMM_Zhang.pool_ne_def|fact"><span class="entity_def" id="AMM_Zhang.pool_ne_def|thm"><span class="entity_def" id="AMM_Zhang.pool_ne_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="AMM_Zhang.pool_ne|const"><span>pool_ne</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹non-empty pool›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pool_ne</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8908..8913">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.l3|fact"><span class="entity_def" id="AMM_Zhang.l3|thm"><span>l3</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="comment1"><span>― ‹if the ratio x to l is the same as x' to l', then removing liquidity l' minus l results in balance x›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>x'</span></span><span> </span><span class="free"><span>l'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>l'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>(</span></span><span class="free"><span>l'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>l'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_add_class.add.right_neutral|fact"><span>add.right_neutral</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.group_add_class.add_diff_cancel|fact"><span>add_diff_cancel</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_8908..8913"><span>assms</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.diff_diff_eq|fact"><span>diff_diff_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.diff_divide_distrib|fact"><span>diff_divide_distrib</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.eq_divide_eq_1|fact"><span>eq_divide_eq_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.group_add_class.minus_diff_eq|fact"><span>minus_diff_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.mult_1|fact"><span>mult_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.nonzero_eq_divide_eq|fact"><span>nonzero_eq_divide_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_irrefl|fact"><span>order_less_irrefl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.times_divide_eq_left|fact"><span>times_divide_eq_left</span></a><span class="main"><span>)</span></span><span>   

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9378..9383">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.l4|fact"><span class="entity_def" id="AMM_Zhang.l4(2)|thm"><span class="entity_def" id="AMM_Zhang.l4(1)|thm"><span>l4</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_9536..9542">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>Δl</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>Δl</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_9573..9579">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p'</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="skolem"><span>Δl</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_9630..9631">1</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="skolem"><span>p'</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9661..9665">have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="skolem"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.diff_divide_distrib|fact"><span>diff_divide_distrib</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9661..9665"><span>that</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9573..9579"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9536..9542"><span>Δl_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_irrefl|fact"><span>order_less_irrefl</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_9934..9935">2</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>Δl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>AMM_Zhang.inv_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9536..9542"><span>Δl_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10004..10005">3</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>Δl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9536..9542"><span>Δl_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="skolem"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="skolem"><span>p'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#offset_9934..9935"><span>2</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#offset_10004..10005"><span>3</span></a><span>"</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9573..9579"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_properties|fact"><span>remove_liquidity_properties</span></a><span class="main"><span>(</span></span><span>11</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9630..9631"><span>1</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>AMM_Zhang.inv_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9536..9542"><span>Δl_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9573..9579"><span>p'_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="skolem"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="skolem"><span>p'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#offset_9934..9935"><span>2</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#offset_10004..10005"><span>3</span></a><span>"</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9573..9579"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_properties|fact"><span>remove_liquidity_properties</span></a><span class="main"><span>(</span></span><span>12</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9630..9631"><span>1</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>AMM_Zhang.inv_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9536..9542"><span>Δl_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9378..9383"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_9573..9579"><span>p'_def</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10585..10590">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.l5|fact"><span class="entity_def" id="AMM_Zhang.l5|thm"><span>l5</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>p'</span></span><span> </span><span class="free"><span>Δx</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>inv_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_10846..10852">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l4|fact"><span>l4</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l3|fact"><span>l3</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10846..10852"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l4|fact"><span>l4</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l3|fact"><span>l3</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10846..10852"><span>p''_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>AMM_Zhang.inv_def</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10585..10590"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_10846..10852"><span>p''_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11555..11560">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.inv_add_okay|fact"><span class="entity_def" id="AMM_Zhang.inv_add_okay|thm"><span>inv_add_okay</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>p'</span></span><span> </span><span class="free"><span>Δx</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>Δx</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p'</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_spec|const"><span>add_liquidity_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δx</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_properties|fact"><span>add_liquidity_properties</span></a><span class="main"><span class="main"><span>(</span></span></span><span>14</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span>
    </span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_properties|fact"><span>add_liquidity_properties</span></a><span class="main"><span class="main"><span>(</span></span></span><span>15</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.add_liquidity_properties|fact"><span>add_liquidity_properties</span></a><span class="main"><span>(</span></span><span>9</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv_def|fact"><span>AMM_Zhang.inv_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l5|fact"><span>l5</span></a><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_11555..11560"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_12247..12252">lemma</span></span></span><span> </span><span class="entity_def" id="AMM_Zhang.inv_rem_okay|fact"><span class="entity_def" id="AMM_Zhang.inv_rem_okay|thm"><span>inv_rem_okay</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>p'</span></span><span> </span><span class="free"><span>Δl</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>p'</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec|const"><span>remove_liquidity_spec</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>Δl</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>Δl</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne|const"><span>pool_ne</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.inv|const"><span>inv</span></a><span> </span><span class="free"><span>p<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.x|const"><span>x</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.y|const"><span>y</span></a><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.l|const"><span>l</span></a><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_left|fact"><span>nonzero_mult_divide_mult_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_less_mult_iff|fact"><span>zero_less_mult_iff</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_left|fact"><span>divide_divide_eq_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>p'_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_ne_def|fact"><span>pool_ne_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.remove_liquidity_spec_def|fact"><span>remove_liquidity_spec_def</span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.pool_state.select_convs|fact"><span>select_convs</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#AMM_Zhang.l5|fact"><span>l5</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="AMM_Zhang.html#offset_12247..12252"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.less_le_not_le|fact"><span>less_le_not_le</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>